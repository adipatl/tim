"use strict";ons.bootstrap().service("PhoneGapService",function(){function t(t){if(!t)return null;if(t.displayName&&t.displayName.length>0)return t.displayName;var e="";return t.name&&(t.name.givenName&&t.name.givenName.length>0&&(e+=t.name.givenName),t.name.familyName&&t.name.familyName.length>0&&(e.length>0&&(e+=" "),e+=t.name.familyName)),e}return{alert:function(t){navigator&&navigator.notification.alert(t)},pickContact:function(e){if("function"==typeof e)if(navigator&&navigator.contacts){var n={};navigator.contacts.pickContact(function(o){if(n.name=t(o),null===o.emails||void 0===o.emails||o.emails.length<=0)navigator.notification.alert("This contact has no email associated");else if(1===o.emails.length)n.email=o.emails[0].value,e(n);else if(o.emails.length>1){for(var i=[],a=0;a<o.emails.length;++a)i.push(o.emails[a].value);navigator.notification.confirm("Please select email for this customer",function(t){t&&t>0&&(n.email=o.emails[t-1].value,e(n))},"Select email",i)}},function(t){console.log("Error: "+t)})}else console.log("cordova is not loaded")},findContact:function(e,n){if("function"==typeof n)if(navigator&&navigator.contacts){var o=new ContactFindOptions;o.filter=e,o.multiple=!0,o.desiredFields=[navigator.contacts.fieldType.id,navigator.contacts.fieldType.name,navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.note];var i=[navigator.contacts.fieldType.name,navigator.contacts.fieldType.displayName];navigator.contacts.find(i,function(o){for(var i=null,a=0;a<o.length;a++)if(t(o[a])===e){i=o[a];break}i&&n(i)},function(t){console.log("error -"+t)},o)}else console.log("cordova is not loaded")}}}).service("ConfigService",function(){return{getUrl:function(t,e){var n,o="",i="";e&&(o=e.employeeId,n=e.contacts,i=e.opportunity);var a="";if("training"===t?a="https://refinitiv.clicktools.com/go?iv=1x1ulqgrvolxi&q1=%20%0D%0A%20&q2="+o:"meeting"===t?a="https://refinitiv.clicktools.com/go?iv=kak1ze2kwqnx&q1=%20%0D%0A%20&q2="+o:"opportunity"===t?a="https://refinitiv.clicktools.com/go?iv=1402c94g3dyou&q1=%20%0D%0A%20&q2="+o:"clientfeedback"===t?a="https://refinitiv.clicktools.com/go?iv=1pwennwy8weqk&q1=%20%0D%0A%20&q2="+o:"enh"===t?a="https://refinitiv.clicktools.com/go?iv=1jbwk8odpi4xn&q1=%20%0D%0A%20&q2="+o:"interview"===t?a="https://refinitiv.clicktools.com/go?iv=3tg6r154u3tgn&q1=%20%0D%0A%20&q2="+o:"pwa"===t?a="https://refinitiv.clicktools.com/go?iv=2tbf87xllgqrf&q6="+o:"timfeedback"===t&&(a="https://refinitiv.clicktools.com/go?iv=19idrjnh2pkf6&q1=%20%0D%0A%20&q2="+o),"opportunity"===t&&(a=a+"&q3="+i),n.length>0)if("training"===t){for(var c=0;c<n.length;++c)a=0==c?a+"&q3="+n[0].email:a+"&q"+(c+4)+"="+n[c].email;n.length>1&&(a=a+"&q4="+(n.length-1))}else a="pwa"===t?a+"&q5="+n[0].email:a+"&q3="+n[0].email;return a},getTitle:function(t){return"training"===t?"Training Event":"meeting"===t?"Meeting Event":"opportunity"===t?"Opportunity Event":"clientfeedback"===t?"Client Feedback":"enh"===t?"Enhancement":""},getLabelForCustomerEmailHeader:function(t){return"training"===t?"Customer email address (max 10)":"opportunity"===t?"Valid Opportunity name":"Customer email address"},getLabelForEmailButton:function(t){return"opportunity"===t?"Select opportunity from contacts":"Select e-mail from contacts"}}}).service("ContactService",["PhoneGapService",function(t){var e=[];return{add:function(t,n){e.push(n),t.$apply()},remove:function(t,n){t.carousel[n].prev({animation:"none"}),e.splice(n,1)},reset:function(t){e.length=0,t.$apply()},selectedContacts:e,pickContact:function(e,n){"function"==typeof e&&t.pickContact(function(t){console.log(t),e(t)})},getNotesFromOpportunity:function(e,n){t.findContact("Opportunities",function(t){for(var o=t.note.split("\n"),i=0;i<o.length;i++){var a=o[i].trim();a.length<=0||n.push({id:i+1,name:a})}e.$apply()})}}}]).controller("MailController",["$scope","ContactService","ConfigService",function(t,e,n){t.remove=function(n){e.remove(t,n)},t.selectedContacts=e.selectedContacts,t.maxSupportedItem=1,this.selectedOpportunity="",t.pickContact=function(){e.pickContact(function(n){e.add(t,n)})},t.submit=function(){var t=window.localStorage;console.log(t.getItem("tim-employeeId"));var o=document.getElementById("content"),i=n.getUrl(o.topPage.data.content.nextPageId,{employeeId:t.getItem("tim-employeeId"),contacts:e.selectedContacts,opportunity:this.mailController.selectedOpportunity});window.open(i,"_system")},t.goBack=function(){document.querySelector("#myNavigator").resetToPage("login.html")};this.init=function(n){console.log("init - mail");var o=document.getElementById("content");console.log("data: "+JSON.stringify(o.topPage.data)),t.maxSupportedItem=1,o.topPage.data.content.maxItem&&(t.maxSupportedItem=parseInt(o.topPage.data.content.maxItem)),t.opportunityNotes=[],e.reset(t)},this.initOpportunity=function(){console.log("init - Oppor"),e.getNotesFromOpportunity(t,t.opportunityNotes)},t.getTitleLabel=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getTitle(t)},t.getCustomerEmailHeader=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getLabelForCustomerEmailHeader(t)},t.getSelectEmailButtonLabel=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getLabelForEmailButton(t)}}]),document.addEventListener("init",function(t){var e,n="tim-employeeId",o=function(t,e){window.localStorage.setItem(t,e)},i=function(t){console.log("go to "+t),document.querySelector("#myNavigator").pushPage(t)},a=function(t){console.log("reset to "+t),document.querySelector("#myNavigator").resetToPage(t)},c=(e=n,window.localStorage.getItem(e)),l=document.querySelector("#myNavigator");l&&l.topPage&&(l.topPage.onDeviceBackButton=function(t){a("login.html")});var r=document.querySelector("#content");r&&r.topPage&&(r.topPage.onDeviceBackButton=function(t){a("login.html")});var m=t.target;if("login"===m.id){var s=document.getElementById("loggingInElement");if("string"==typeof c&&c.length>0)return s.show(),void setTimeout(function(){i("landing.html")},100);var g=document.getElementById("employee-id"),u=document.getElementById("next");g.onkeyup=function(t){u.disabled=g.value.length<=0},u.onclick=function(t){o(n,g.value),s.show(),i("landing.html")}}else{if(m.id.startsWith("content")){var d=document.getElementById("menu"),p=document.getElementById("menu-button"),f=document.getElementById("menu-home"),v=document.getElementById("menu-reset");p&&(p.onclick=function(t){d.open()}),f&&(f.onclick=function(t){a("login.html")}),v&&(v.onclick=function(t){o(n,""),a("login.html")})}var y=function(t){if("navigate"!==t.srcElement.dataset.nextPage){var e=t.srcElement.dataset.nextPage+".html",n=t.srcElement.dataset,o=document.getElementById("content"),i=document.getElementById("menu"),a={data:{content:n}};o.resetToPage(e,a).then(i.close.bind(i))}else{var c="https://survey.clicktools.com/app/survey/go.jsp?iv=323zmt2kpsnc1&q2="+window.localStorage.getItem("tim-employeeId");window.open(c,"_system")}};if("content-home"===m.id)for(var h=document.getElementsByTagName("ons-button"),k=0;k<h.length;k++)h[k].onclick=y}});