"use strict";ons.bootstrap().service("PhoneGapService",function(){function t(t){if(!t)return null;if(t.displayName&&t.displayName.length>0)return t.displayName;var e="";return t.name&&(t.name.givenName&&t.name.givenName.length>0&&(e+=t.name.givenName),t.name.familyName&&t.name.familyName.length>0&&(e.length>0&&(e+=" "),e+=t.name.familyName)),e}return{alert:function(t){navigator&&navigator.notification.alert(t)},pickContact:function(e){if("function"==typeof e)if(navigator&&navigator.contacts){var n={};navigator.contacts.pickContact(function(o){if(n.name=t(o),null===o.emails||void 0===o.emails||o.emails.length<=0)navigator.notification.alert("This contact has no email associated");else if(1===o.emails.length)n.email=o.emails[0].value,e(n);else if(o.emails.length>1){for(var a=[],i=0;i<o.emails.length;++i)a.push(o.emails[i].value);navigator.notification.confirm("Please select email for this customer",function(t){t&&t>0&&(n.email=o.emails[t-1].value,e(n))},"Select email",a)}},function(t){console.log("Error: "+t)})}else console.log("cordova is not loaded")},findContact:function(e,n){if("function"==typeof n)if(navigator&&navigator.contacts){var o=new ContactFindOptions;o.filter=e,o.multiple=!0,o.desiredFields=[navigator.contacts.fieldType.id,navigator.contacts.fieldType.name,navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.note];var a=[navigator.contacts.fieldType.name,navigator.contacts.fieldType.displayName];navigator.contacts.find(a,function(o){for(var a=null,i=0;i<o.length;i++)if(t(o[i])===e){a=o[i];break}a&&n(a)},function(t){console.log("error -"+t)},o)}else console.log("cordova is not loaded")}}}).service("ConfigService",function(){return{getUrl:function(t,e){var n,o="",a="";e&&(o=e.employeeId,n=e.contacts,a=e.opportunity);var i="";if("training"===t?i="http://data-capture.financial.thomsonreuters.com/go?iv=t4cqtyisrcp9&q11="+o:"meeting"===t?i="http://data-capture.financial.thomsonreuters.com/go?iv=384s5oqum0qd6&q2="+o:"opportunity"===t?i="https://survey.clicktools.com/app/survey/go.jsp?iv=2bsqu91m0xhbo&q2="+o:"clientfeedback"===t?i="http://data-capture.financial.thomsonreuters.com/go?iv=1s5p8l5gk7w22&q2="+o:"contentenh"===t?i="http://data-capture.financial.thomsonreuters.com/go?iv=1wi4x8k9kn4z2&q2="+o:"productenh"===t&&(i="http://data-capture.financial.thomsonreuters.com/go?iv=3hh23k27tplyw&q2="+o),"opportunity"===t)i=i+"&q1="+a;else for(var c=1;c<n.length+1;++c)i=i+"&q"+c+"="+n[c-1].email;return i},getTitle:function(t){return"training"===t?"Training Event":"meeting"===t?"Meeting Event":"opportunity"===t?"Opportunity Event":"clientfeedback"===t?"Client Feedback":"contentenh"===t?"Content Enhancement":"productenh"===t?"Product Enhancement":""},getLabelForCustomerEmailHeader:function(t){return"training"===t?"Customer email address (max 10)":"opportunity"===t?"Valid Opportunity name":"Customer email address"},getLabelForEmailButton:function(t){return"opportunity"===t?"Select opportunity from contacts":"Select e-mail from contacts"}}}).service("ContactService",["PhoneGapService",function(t){var e=[];return{add:function(t,n){e.push(n),t.$apply()},remove:function(t,n){t.carousel[n].prev({animation:"none"}),e.splice(n,1)},reset:function(t){e.length=0,t.$apply()},selectedContacts:e,pickContact:function(e,n){"function"==typeof e&&t.pickContact(function(t){console.log(t),e(t)})},getNotesFromOpportunity:function(e,n){t.findContact("Opportunities",function(t){for(var o=t.note.split("\n"),a=0;a<o.length;a++)n.push({id:a+1,name:o[a]});e.$apply()})}}}]).controller("MailController",["$scope","ContactService","ConfigService",function(t,e,n){t.remove=function(n){e.remove(t,n)},t.selectedContacts=e.selectedContacts,t.maxSupportedItem=1,this.selectedOpportunity="",t.pickContact=function(){e.pickContact(function(n){e.add(t,n)})},t.submit=function(){var t=window.localStorage;console.log(t.getItem("tim-employeeId"));var o=document.getElementById("content"),a=n.getUrl(o.topPage.data.content.nextPageId,{employeeId:t.getItem("tim-employeeId"),contacts:e.selectedContacts,opportunity:this.mailController.selectedOpportunity});window.open(a,"_system")},t.goBack=function(){document.querySelector("#myNavigator").resetToPage("login.html")};this.init=function(n){console.log("init - mail");var o=document.getElementById("content");console.log("data: "+JSON.stringify(o.topPage.data)),t.maxSupportedItem=1,o.topPage.data.content.maxItem&&(t.maxSupportedItem=parseInt(o.topPage.data.content.maxItem)),t.opportunityNotes=[],e.reset(t)},this.initOpportunity=function(){console.log("init - Oppor"),e.getNotesFromOpportunity(t,t.opportunityNotes)},t.getTitleLabel=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getTitle(t)},t.getCustomerEmailHeader=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getLabelForCustomerEmailHeader(t)},t.getSelectEmailButtonLabel=function(){var t=document.getElementById("content").topPage.data.content.nextPageId;return n.getLabelForEmailButton(t)}}]),document.addEventListener("init",function(t){var e,n="tim-employeeId",o=function(t,e){window.localStorage.setItem(t,e)},a=function(t){console.log("go to "+t),document.querySelector("#myNavigator").pushPage(t)},i=function(t){console.log("reset to "+t),document.querySelector("#myNavigator").resetToPage(t)},c=(e=n,window.localStorage.getItem(e)),r=document.querySelector("#myNavigator");r&&r.topPage&&(r.topPage.onDeviceBackButton=function(t){i("login.html")});var l=document.querySelector("#content");l&&l.topPage&&(l.topPage.onDeviceBackButton=function(t){i("login.html")});var m=t.target;if("login"===m.id){var u=document.getElementById("loggingInElement");if("string"==typeof c&&c.length>0)return u.show(),void setTimeout(function(){a("landing.html")},100);var s=document.getElementById("employee-id"),g=document.getElementById("next");s.onkeyup=function(t){g.disabled=s.value.length<=0},g.onclick=function(t){o(n,s.value),u.show(),a("landing.html")}}else{if(m.id.startsWith("content")){var d=document.getElementById("menu"),p=document.getElementById("menu-button"),f=document.getElementById("menu-home"),v=document.getElementById("menu-reset");p&&(p.onclick=function(t){d.open()}),f&&(f.onclick=function(t){i("login.html")}),v&&(v.onclick=function(t){o(n,""),i("login.html")})}var y=function(t){var e=t.srcElement.dataset.nextPage+".html",n=t.srcElement.dataset,o=document.getElementById("content"),a=document.getElementById("menu"),i={data:{content:n}};o.resetToPage(e,i).then(a.close.bind(a))};if("content-home"===m.id)for(var h=document.getElementsByTagName("ons-button"),I=0;I<h.length;I++)h[I].onclick=y}});